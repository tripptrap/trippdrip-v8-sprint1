name: Process Scheduled Messages

  on:
    schedule:
      # Runs every 5 minutes
      - cron: '*/5 * * * *'

    # Allows manual triggering from GitHub Actions tab
    workflow_dispatch:

  jobs:
    process-scheduled-messages:
      runs-on: ubuntu-latest

      steps:
        - name: Trigger Cron Endpoint
          run: |
            response=$(curl -s -w "\n%{http_code}" -X GET \
              
  "https://trippdrip-v8-sprint1.vercel.app/api/cron/process-scheduled" \
              -H "x-cron-secret: ${{ secrets.CRON_SECRET }}")

            http_code=$(echo "$response" | tail -n1)
            body=$(echo "$response" | head -n-1)

            echo "HTTP Status: $http_code"
            echo "Response: $body"

            if [ "$http_code" -ne 200 ]; then
              echo "Error: Cron job failed with status $http_code"
              exit 1
            fi

            echo "âœ… Scheduled messages processed successfully"
